---
 - name:  polytechnic outlook.in
   hosts: localhost
   vars_files:
      - aws_access.yml
   tasks:
    - block:
      - name: stopped ec2 instances
        ec2_instance: 
         state: stopped
         instance_ids: 
          - i-050b67f73c6f149e7
          - i-0548dd56d3d597caf
          - i-0c5a73fb9ede48544
          - i-0c9c54a2b2368ef5a
          - i-0dba87ba03ddbb7da


        register: result

      always:
       - name: Sending an e-mail using Legacy SSL to the remote machine
         mail:
          to: SONU LODHA <sonulodha.gcp@gmail.com>
          subject: Ansible report ! Polytechnic outlook.in
          body: Is ec2 instances stopped ? !{{ result.changed }}.

    - block:
       - name: change utd t3a.micro
         shell: >
           aws ec2 modify-instance-attribute --instance-id i-050b67f73c6f149e7 --instance-type "{\"Value\": \"t3a.medium\"}"
          
       - name: change shahdol t3a.micro
         shell: >
          aws ec2 modify-instance-attribute --instance-id i-0548dd56d3d597caf --instance-type "{\"Value\": \"t3a.medium\"}"
   
       - name: change polytehcnic t3a.micro
         shell: >
           aws ec2 modify-instance-attribute --instance-id i-0c5a73fb9ede48544 --instance-type "{\"Value\": \"t3a.medium\"}"

       - name: change mca
         shell: >
           aws ec2 modify-instance-attribute --instance-id i-0c9c54a2b2368ef5a --instance-type "{\"Value\": \"t3a.medium\"}"

       - name: change pce
         shell: >
           aws ec2 modify-instance-attribute --instance-id i-0dba87ba03ddbb7da --instance-type "{\"Value\": \"t3a.large\"}"

      always:
       - name: Sending an e-mail using Legacy SSL to the remote machine
         mail:
          to: SONU LODHA <sonulodha.gcp@gmail.com>
          subject: Ansible report ! Polytechnic outlook.in
          body: Is ec2 instances modify ? ! No idea. Please wait next mail!

    - block:
      - name: started ec2 instances
        ec2_instance: 
         state: started
         instance_ids: 
          - i-050b67f73c6f149e7
          - i-0548dd56d3d597caf
          - i-0c5a73fb9ede48544
          - i-0c9c54a2b2368ef5a
          - i-0dba87ba03ddbb7da
        register: stopped_err

      always:
       - name: Sending an e-mail using Legacy SSL to the remote machine
         mail:
          to: SONU LODHA <sonulodha.gcp@gmail.com>
          subject: Ansible report ! Polytechnic outlook.in
          body: Is ec2 instances started ? !{{ result.changed }}.
